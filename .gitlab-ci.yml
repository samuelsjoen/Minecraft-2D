stages:
  - build
  - test
  - visualize

build:
  stage: build
  image: gradle:8.6-jdk21
  script:
    - echo "Building the project..."
    - gradle build
  only:
    - main

test:
  stage: test
  image: gradle:8.6-jdk21
  script:
    - echo "Testing the project..."
    - gradle test jacocoTestReport
  artifacts:
    paths:
      - core/build/reports/jacoco/test/jacocoTestReport.xml
  only:
    - main

test-coverage: 
  stage: visualize 
  image: registry.gitlab.com/haynes/jacoco2cobertura:1.0.7
  script: 
    - python /opt/cover2cover.py core/build/reports/jacoco/test/jacocoTestReport.xml core/build > core/build/cobertura.xml
  needs: ["test"] 
  coverage: '/Total.*?([0-9]{1,3})%/'
  artifacts: 
    reports: 
      coverage_report:
        coverage_format: cobertura
        path: core/build/cobertura.xml
  only:
  - main
